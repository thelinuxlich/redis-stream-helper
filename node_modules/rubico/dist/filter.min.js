/**
 * rubico v1.8.1
 * https://github.com/a-synchronous/rubico
 * (c) 2019-2021 Richard Tong
 * rubico may be freely distributed under the MIT license.
 */

!function(n,t){"object"==typeof module?module.exports=t:"function"==typeof define?define((()=>t)):n.filter=t}("object"==typeof globalThis?globalThis:this,function(){"use strict";const n=Symbol.iterator,t=(t,e)=>({[n](){return this},next(){let n=t.next();for(;!n.done;){const{value:o}=n;if(e(o))return{value:o,done:!1};n=t.next()}return n}}),e=n=>null!=n&&"function"==typeof n.then,o=Symbol.asyncIterator,r=(n,t)=>({[o](){return this},async next(){let o=await n.next();for(;!o.done;){const{value:r}=o,u=t(r);if(e(u)?await u:u)return{value:r,done:!1};o=await n.next()}return o}}),u=Array.isArray,c=Object.prototype.toString,i=n=>c.call(n),f=Symbol.for("placeholder"),s=function(n,t,e,o,r){return t==f?((n,t,e,o)=>function(r){return n(r,t,e,o)})(n,e,o,r):e==f?((n,t,e,o)=>function(r){return n(t,r,e,o)})(n,t,o,r):o==f?((n,t,e,o)=>function(r){return n(t,e,r,o)})(n,t,e,r):((n,t,e,o)=>function(r){return n(t,e,o,r)})(n,t,e,o)},l=Promise.all.bind(Promise),h=function(n,t,e,o){const r=t.length;let u=n.length-1;for(;++o<r;)n[++u]=e(t[o],o,n);return n},a=function(n,t,e,o){const r=n.length;let u=-1;for(;++e<r;)o[++u]&&t.push(n[e]);return t},y=function(n,t){const o=n.length,r=[];let u=-1,c=-1;for(;++u<o;){const o=n[u],i=t(o);if(e(i))return l(h([i],n,t,u)).then(s(a,n,r,u-1,f));i&&(r[++c]=o)}return r},p=function(n,t,e,o){return t==f?((n,t,e)=>function(o){return n(o,t,e)})(n,e,o):e==f?((n,t,e)=>function(o){return n(t,o,e)})(n,t,o):((n,t,e)=>function(o){return n(t,e,o)})(n,t,e)},d=(n,t,e)=>n?t():e(),g=n=>function(){return n},b=(n,t,e)=>n[t](e),j=(n,t)=>function(){return n(t)},w=function(){},x=(n,t,e,o,r)=>function(){return n(t,e,o,r)},m=(n,t,e,o)=>n[t](e,o),S=function(n,t,e,o){o&&(n[t]=e)},v=function(n,t,e,o){const r=t.length;let u=n.length-1;for(;++o<r;)n[++u]=e(t[o],o,t);return n},A=c=>function(h){return u(h)?y(h,c):"function"==typeof h?(n=>"[object GeneratorFunction]"==i(n))(h)?((n,e)=>function*(...o){yield*t(n(...o),e)})(h,c):(n=>"[object AsyncGeneratorFunction]"==i(n))(h)?((n,t)=>async function*(...e){yield*r(n(...e),t)})(h,c):((n,t)=>function(o,r){const u=t(r);return e(u)?u.then(p(d,f,(c=n,i=o,s=r,function(){return c(i,s)}),g(o))):u?n(o,r):o;var c,i,s})(h,c):null==h?h:"string"==typeof h||h.constructor==String?function(n,t){const o=y(n,t);return e(o)?o.then(p(b,f,"join","")):o.join("")}(h,c):h.constructor==Set?function(n,t){const o=new Set,r=o.add.bind(o),u=[];for(const c of n){const i=t(c,c,n);e(i)?u.push(i.then(p(d,f,j(r,c),w))):i&&o.add(c)}return 0==u.length?o:l(u).then(g(o))}(h,c):h.constructor==Map?function(n,t){const o=new Map,r=[];for(const[u,c]of n){const i=t(c,u,n);e(i)?r.push(i.then(p(d,f,x(m,o,"set",u,c),w))):i&&o.set(u,c)}return 0==r.length?o:l(r).then(g(o))}(h,c):"function"==typeof h.filter?h.filter(c):h.constructor==Object?function(n,t){const o={},r=[];for(const u in n){const c=n[u],i=t(c,u,n);e(i)?r.push(i.then(s(S,o,u,n[u],f))):i&&(o[u]=c)}return 0==r.length?o:l(r).then(g(o))}(h,c):"function"==typeof h[n]?t(h[n](),c):"function"==typeof h[o]?r(h[o](),c):h};return A.withIndex=n=>function(t){if(u(t))return function(n,t){const o=n.length,r=[];let u=-1,c=-1;for(;++u<o;){const o=n[u],i=t(o,u,n);if(e(i))return l(v([i],n,t,u)).then(s(a,n,r,u-1,f));i&&(r[++c]=o)}return r}(t,n);throw new TypeError(`${t} is not an Array`)},A}());
