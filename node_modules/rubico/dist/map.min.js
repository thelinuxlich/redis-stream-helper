/**
 * rubico v1.8.1
 * https://github.com/a-synchronous/rubico
 * (c) 2019-2021 Richard Tong
 * rubico may be freely distributed under the MIT license.
 */

!function(n,t){"object"==typeof module?module.exports=t:"function"==typeof define?define((()=>t)):n.map=t}("object"==typeof globalThis?globalThis:this,function(){"use strict";const n=Symbol.iterator,t=(t,r)=>({toString:()=>"[object MappingIterator]",[n](){return this},next(){const n=t.next();return n.done?n:{value:r(n.value),done:!1}}}),r=n=>({value:n,done:!1}),o=n=>null!=n&&"function"==typeof n.then,e=Symbol.asyncIterator,c=(n,t)=>({[e](){return this},async next(){const e=await n.next();if(e.done)return e;const c=t(e.value);return o(c)?c.then(r):{value:c,done:!1}}}),u=Array.isArray,i=Object.prototype.toString,f=n=>i.call(n),s=Promise.all.bind(Promise),a=function(n,t){const r=n.length,e=Array(r);let c=-1,u=!1;for(;++c<r;){const r=t(n[c],c,n);o(r)&&(u=!0),e[c]=r}return u?s(e):e},l=Symbol.for("placeholder"),h=(n,t)=>function(r,e){const c=t(e);return o(c)?c.then((u=n,f=l,(i=r)==l?((n,t)=>function(r){return n(r,t)})(u,f):((n,t)=>function(r){return n(t,r)})(u,i))):n(r,c);var u,i,f},p=function(n,t,r,o){return t==l?((n,t,r)=>function(o){return n(o,t,r)})(n,r,o):r==l?((n,t,r)=>function(o){return n(t,o,r)})(n,t,o):((n,t,r)=>function(o){return n(t,r,o)})(n,t,r)},y=(n,t,r)=>n[t](r),d=n=>function(){return n},w=function(n,t,r,o,e){return t==l?((n,t,r,o)=>function(e){return n(e,t,r,o)})(n,r,o,e):r==l?((n,t,r,o)=>function(e){return n(t,e,r,o)})(n,t,o,e):o==l?((n,t,r,o)=>function(e){return n(t,r,e,o)})(n,t,r,e):((n,t,r,o)=>function(e){return n(t,r,o,e)})(n,t,r,o)},g=(n,t,r,o)=>n[t](r,o),b=n=>new Promise((n=>function(t){const r={};let e=0;for(const c in n){const u=n[c];o(u)?(e+=1,u.then((n=>function(o){r[n]=o,e-=1,0==e&&t(r)})(c))):r[c]=u}0==e&&t(r)})(n)),j=(n,t)=>function(...r){const e=n(...r);return o(e)?e.then(t):t(e)},m=function(n,t,r){return n[t]=r,n},A=async function(n,t,r,e){const c=n.length;for(;++e<c;){const c=t(n[e]);r[e]=o(c)?await c:c}return r},S=n=>function(...t){return n(...t),t[0]},v=Promise.race.bind(Promise),O=async function(n,t,r,e,c,u){const i=n.length;for(;++c<i;){u.size>=r&&await v(u);const i=t(n[c]);if(o(i)){const n=i.then(S((()=>u.delete(n))));u.add(n),e[c]=n}else e[c]=i}return s(e)},T=Object.prototype.hasOwnProperty,E=(n,t)=>T.call(n,t),M=(n,t,r)=>function(...o){const e=r.length,c=o.length,u=[];let i=-1,f=-1,s=0;for(;++i<e;){const e=r[i];if(e==l&&(f+=1)<c){const n=o[f];n==l&&(s+=1),u.push(n)}else u.push(e);if(u.length==n)return 0==s?t(...u):x(n,t,u)}for(;++f<c;){const r=o[f];if(r==l&&(s+=1),u.push(r),u.length==n)return 0==s?t(...u):x(n,t,u)}return x(n,t,u)},x=function(n,t,r){const o=r.length;if(o<n)return M(n,t,r);let e=-1;for(;++e<o;){if(r[e]==l)return M(n,t,r)}return t(...r)},P=n=>function([t,r]){return n(t,r)},$=function(n,t,r){return n.set(t,r)},I=function(n,t){const r=new Map,e=[];return n.forEach(((n,t,r)=>function(e,c){const u=n([c,e]);o(u)?r.push(u.then(P(x(3,$,[t])))):t.set(u[0],u[1])})(t,r,e)),0==e.length?r:s(e).then(d(r))},F=r=>function(i){return u(i)?a(i,r):"function"==typeof i?(n=>"[object GeneratorFunction]"==f(n))(i)?((n,t)=>function*(...r){for(const o of n(...r))yield t(o)})(i,r):(n=>"[object AsyncGeneratorFunction]"==f(n))(i)?function(n,t){return async function*(...r){for await(const o of n(...r))yield t(o)}}(i,r):h(i,r):null==i?i:"function"==typeof i.then?i.then(r):"function"==typeof i.map?i.map(r):"string"==typeof i||i.constructor==String?function(n,t){const r=a(n,t);return o(r)?r.then(p(y,l,"join","")):r.join("")}(i,r):i.constructor==Set?function(n,t){const r=new Set,e=[];for(const c of n){const u=t(c,c,n);o(u)?e.push(u.then(p(y,r,"add",l))):r.add(u)}return 0==e.length?r:s(e).then(d(r))}(i,r):i.constructor==Map?function(n,t){const r=new Map,e=[];for(const[c,u]of n){const i=t(u,c,n);o(i)?e.push(i.then(w(g,r,"set",c,l))):r.set(c,i)}return 0==e.length?r:s(e).then(d(r))}(i,r):i.constructor==Object?function(n,t){const r={};let e=!1;for(const c in n){const u=t(n[c],c,n);o(u)&&(e=!0),r[c]=u}return e?b(r):r}(i,r):"function"==typeof i[n]?t(i[n](),r):"function"==typeof i[e]?c(i[e](),r):r(i)};return F.entries=function(n){return function(t){if(null==t)throw new TypeError("value is not an Object or Map");if(t.constructor==Object)return function(n,t){const r={},e=[];for(const c in n){const u=t([c,n[c]]);o(u)?e.push(u.then(P(x(3,m,[r])))):r[u[0]]=u[1]}return 0==e.length?r:s(e).then(d(r))}(t,n);if(t.constructor==Map)return I(t,n);throw new TypeError("value is not an Object or Map")}},F.series=n=>function(t){if(u(t))return function(n,t){const r=n.length,e=Array(r);let c=-1;for(;++c<r;){const r=t(n[c]);if(o(r))return r.then(j(p(m,e,c,l),w(A,n,t,l,c)));e[c]=r}return e}(t,n);throw new TypeError(`${t} is not an Array`)},F.pool=(n,t)=>function(r){if(u(r))return function(n,t,r){const e=n.length,c=Array(e);let u=-1;for(;++u<e;){const e=t(n[u]);if(o(e)){const o=new Set,i=e.then(S((()=>o.delete(i))));return o.add(i),c[u]=i,O(n,t,r,c,u,o)}c[u]=e}return c}(r,t,n);throw new TypeError(`${r} is not an Array`)},F.withIndex=n=>function(t){if(u(t))return function(n,t){const r=n.length,e=Array(r);let c=-1,u=!1;for(;++c<r;){const r=t(n[c],c,n);o(r)&&(u=!0),e[c]=r}return u?s(e):e}(t,n);throw new TypeError(`${t} is not an Array`)},F.own=n=>function(t){if((n=>{if(null==n)return!1;const t=typeof n;return"object"==t||"function"==t})(t)&&!u(t))return function(n,t){const r={};let e=!1;for(const c in n)if(E(n,c)){const u=t(n[c]);o(u)&&(e=!0),r[c]=u}return e?b(r):r}(t,n);throw new TypeError(`${t} is not an Object`)},F}());
