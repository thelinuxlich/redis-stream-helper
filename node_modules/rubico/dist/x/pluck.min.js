/**
 * rubico v1.8.1
 * https://github.com/a-synchronous/rubico
 * (c) 2019-2021 Richard Tong
 * rubico may be freely distributed under the MIT license.
 */

!function(n,t){"object"==typeof module?module.exports=t:"function"==typeof define?define((()=>t)):n.pluck=t}("object"==typeof globalThis?globalThis:this,function(){"use strict";const n=n=>null!=n&&"function"==typeof n.then,t=(t,r)=>function(...o){const e=t(...o);return n(e)?e.then(r):r(e)},r=Symbol.iterator,o=(n,t)=>({toString:()=>"[object MappingIterator]",[r](){return this},next(){const r=n.next();return r.done?r:{value:t(r.value),done:!1}}}),e=n=>({value:n,done:!1}),c=Symbol.asyncIterator,u=(t,r)=>({[c](){return this},async next(){const o=await t.next();if(o.done)return o;const c=r(o.value);return n(c)?c.then(e):{value:c,done:!1}}}),i=Array.isArray,f=Object.prototype.toString,s=n=>f.call(n),l=Promise.all.bind(Promise),a=function(t,r){const o=t.length,e=Array(o);let c=-1,u=!1;for(;++c<o;){const o=r(t[c],c,t);n(o)&&(u=!0),e[c]=o}return u?l(e):e},h=Symbol.for("placeholder"),p=(t,r)=>function(o,e){const c=r(e);return n(c)?c.then((u=t,f=h,(i=o)==h?((n,t)=>function(r){return n(r,t)})(u,f):((n,t)=>function(r){return n(t,r)})(u,i))):t(o,c);var u,i,f},y=function(n,t,r,o){return t==h?((n,t,r)=>function(o){return n(o,t,r)})(n,r,o):r==h?((n,t,r)=>function(o){return n(t,o,r)})(n,t,o):((n,t,r)=>function(o){return n(t,r,o)})(n,t,r)},d=(n,t,r)=>n[t](r),g=n=>function(){return n},w=function(n,t,r,o,e){return t==h?((n,t,r,o)=>function(e){return n(e,t,r,o)})(n,r,o,e):r==h?((n,t,r,o)=>function(e){return n(t,e,r,o)})(n,t,o,e):o==h?((n,t,r,o)=>function(e){return n(t,r,e,o)})(n,t,r,e):((n,t,r,o)=>function(e){return n(t,r,o,e)})(n,t,r,o)},b=(n,t,r,o)=>n[t](r,o),j=t=>new Promise((t=>function(r){const o={};let e=0;for(const c in t){const u=t[c];n(u)?(e+=1,u.then((n=>function(t){o[n]=t,e-=1,0==e&&r(o)})(c))):o[c]=u}0==e&&r(o)})(t)),m=function(n,t,r){return n[t]=r,n},v=async function(t,r,o,e){const c=t.length;for(;++e<c;){const c=r(t[e]);o[e]=n(c)?await c:c}return o},A=n=>function(...t){return n(...t),t[0]},S=Promise.race.bind(Promise),M=async function(t,r,o,e,c,u){const i=t.length;for(;++c<i;){u.size>=o&&await S(u);const i=r(t[c]);if(n(i)){const n=i.then(A((()=>u.delete(n))));u.add(n),e[c]=n}else e[c]=i}return l(e)},O=Object.prototype.hasOwnProperty,T=(n,t)=>O.call(n,t),E=(n,t,r)=>function(...o){const e=r.length,c=o.length,u=[];let i=-1,f=-1,s=0;for(;++i<e;){const e=r[i];if(e==h&&(f+=1)<c){const n=o[f];n==h&&(s+=1),u.push(n)}else u.push(e);if(u.length==n)return 0==s?t(...u):x(n,t,u)}for(;++f<c;){const r=o[f];if(r==h&&(s+=1),u.push(r),u.length==n)return 0==s?t(...u):x(n,t,u)}return x(n,t,u)},x=function(n,t,r){const o=r.length;if(o<n)return E(n,t,r);let e=-1;for(;++e<o;){if(r[e]==h)return E(n,t,r)}return t(...r)},P=n=>function([t,r]){return n(t,r)},$=function(n,t,r){return n.set(t,r)},I=function(t,r){const o=new Map,e=[];return t.forEach(((t,r,o)=>function(e,c){const u=t([c,e]);n(u)?o.push(u.then(P(x(3,$,[r])))):r.set(u[0],u[1])})(r,o,e)),0==e.length?o:l(e).then(g(o))},z=t=>function(e){return i(e)?a(e,t):"function"==typeof e?(n=>"[object GeneratorFunction]"==s(n))(e)?((n,t)=>function*(...r){for(const o of n(...r))yield t(o)})(e,t):(n=>"[object AsyncGeneratorFunction]"==s(n))(e)?function(n,t){return async function*(...r){for await(const o of n(...r))yield t(o)}}(e,t):p(e,t):null==e?e:"function"==typeof e.then?e.then(t):"function"==typeof e.map?e.map(t):"string"==typeof e||e.constructor==String?function(t,r){const o=a(t,r);return n(o)?o.then(y(d,h,"join","")):o.join("")}(e,t):e.constructor==Set?function(t,r){const o=new Set,e=[];for(const c of t){const u=r(c,c,t);n(u)?e.push(u.then(y(d,o,"add",h))):o.add(u)}return 0==e.length?o:l(e).then(g(o))}(e,t):e.constructor==Map?function(t,r){const o=new Map,e=[];for(const[c,u]of t){const i=r(u,c,t);n(i)?e.push(i.then(w(b,o,"set",c,h))):o.set(c,i)}return 0==e.length?o:l(e).then(g(o))}(e,t):e.constructor==Object?function(t,r){const o={};let e=!1;for(const c in t){const u=r(t[c],c,t);n(u)&&(e=!0),o[c]=u}return e?j(o):o}(e,t):"function"==typeof e[r]?o(e[r](),t):"function"==typeof e[c]?u(e[c](),t):t(e)};z.entries=function(t){return function(r){if(null==r)throw new TypeError("value is not an Object or Map");if(r.constructor==Object)return function(t,r){const o={},e=[];for(const c in t){const u=r([c,t[c]]);n(u)?e.push(u.then(P(x(3,m,[o])))):o[u[0]]=u[1]}return 0==e.length?o:l(e).then(g(o))}(r,t);if(r.constructor==Map)return I(r,t);throw new TypeError("value is not an Object or Map")}},z.series=r=>function(o){if(i(o))return function(r,o){const e=r.length,c=Array(e);let u=-1;for(;++u<e;){const e=o(r[u]);if(n(e))return e.then(t(y(m,c,u,h),w(v,r,o,h,u)));c[u]=e}return c}(o,r);throw new TypeError(`${o} is not an Array`)},z.pool=(t,r)=>function(o){if(i(o))return function(t,r,o){const e=t.length,c=Array(e);let u=-1;for(;++u<e;){const e=r(t[u]);if(n(e)){const n=new Set,i=e.then(A((()=>n.delete(i))));return n.add(i),c[u]=i,M(t,r,o,c,u,n)}c[u]=e}return c}(o,r,t);throw new TypeError(`${o} is not an Array`)},z.withIndex=t=>function(r){if(i(r))return function(t,r){const o=t.length,e=Array(o);let c=-1,u=!1;for(;++c<o;){const o=r(t[c],c,t);n(o)&&(u=!0),e[c]=o}return u?l(e):e}(r,t);throw new TypeError(`${r} is not an Array`)},z.own=t=>function(r){if((n=>{if(null==n)return!1;const t=typeof n;return"object"==t||"function"==t})(r)&&!i(r))return function(t,r){const o={};let e=!1;for(const c in t)if(T(t,c)){const u=r(t[c]);n(u)&&(e=!0),o[c]=u}return e?j(o):o}(r,t);throw new TypeError(`${r} is not an Object`)};const F=/[.|[|\]]+/,G=function(n,t){const r=new Map,o=function(o){if(r.has(o))return r.get(o);const e=n(o);return r.set(o,e),r.size>t&&r.clear(),e};return o.cache=r,o}((function(n){const t=n.length-1,r="["==n[0],o="]"==n[t];return r&&o?n.slice(1,t).split(F):r?n.slice(1).split(F):o?n.slice(0,t).split(F):n.split(F)}),500),k=function(n,t){const r=(n=>i(n)?n:"string"==typeof n?G(n):[n])(t),o=r.length;let e=-1,c=n;for(;++e<o;)if(c=c[r[e]],null==c)return;return c};return t(((n,t)=>function(r){const o=null==r?void 0:k(r,n);return void 0===o?"function"==typeof t?t(r):t:o}),z)}());
